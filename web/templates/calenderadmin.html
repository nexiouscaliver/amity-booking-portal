<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booking Calendar</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            background-color: aliceblue;
            margin: 0;
            font-family: Arial, sans-serif;
            font-size: 16px;
            line-height: 1.5;
        }
        
        :root {
            --primary-color: #04172b;
            --secondary-color: #061b31;
            --white: #ffffff;
            --gray: #6c757d;   
        }
        
        .navbar {
            background-color: var(--primary-color);
            display: flex;
            align-items: center;
            padding: 10px 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            flex-wrap: nowrap;
            justify-content: space-evenly; /* Space between logo and menu */
        }
        
        .logo-container {
          display: flex;
          align-items: center;
          flex: 0 1 auto; /* Prevent the logo from stretching */
          margin-right: 0; /* Align logo container to the left */
      }
        
        .navbar .logo img {
            height: 50px;
            margin-right: 10px;
        }
        
        .navbar .name img {
          height: 40px;
      }
        
        .navbar .menu {
          display: flex;
          align-items: center;
          flex-wrap: nowrap;
          justify-content: space-evenly; /* Evenly space out menu items */
          flex: 0 1 auto; /* Prevent the menu from stretching */
          margin-left: 0; /* Align menu to the right */
      }
      
        
        .navbar .menu a {
            color: var(--white);
            text-decoration: none;
            padding: 10px 15px;
            border-radius: 5px;
            transition: background-color 0.3s, box-shadow 0.3s;
            font-weight: bold;
            display: flex;
            align-items: center;
            white-space: nowrap; /* Prevent text wrapping */
            text-align: center;
            justify-content: center;
            flex: 1;
        }
        
        .navbar .menu a:hover {
            background-color: var(--secondary-color);
            transform: scale(1.05);
            box-shadow: 0 0 0 2px aliceblue;
        }
        
        .navbar .icon {
            font-size: 20px;
            color: var(--white);
            padding: 10px;
            cursor: pointer;
            font-weight: bold;
            position: relative;
        }
        
        /* Responsive styles */
        @media (max-width: 768px) {
            .navbar {
                padding: 10px;
            }
        
            .navbar .menu a {
                padding: 8px 10px;
                font-size: 12px;
            }
        }
        
        @media (min-width: 769px) and (max-width: 1024px) {
            .navbar .menu a {
                padding: 10px;
                font-size: 14px;
            }
        }
        
        @media (min-width: 1025px) {
            .navbar {
                justify-content: space-between; /* Maintain space-between on large screens */
            }
        
            .logo-container {
                margin-right: auto; /* Position logo container to the left */
            }
        
            .navbar .menu {
                margin-left: auto; /* Position menu to the right */
            }
        }
          
      
      
        
        
        /* Base styles (mobile-first) */
      
        .navbar {
          flex-direction: column;
          padding: 10px;
        }
      
        .logo img, .name img {
          height: auto;
          max-width: 100%;
        }
        
        /* Responsive adjustments */
        @media (min-width: 600px) {
          .navbar {
            flex-direction: row;
          }
        
         
        }








          .calendar-container {
            background: #e0f7fa; /* Aquatic theme background */
            border-radius: 8px; /* Adjust the radius for a more curved appearance */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            width: 60%; /* Adjust as needed */
            max-width: 100%;
            margin: 20px auto; /* Center the container horizontally with margin auto */
            padding: 10px;
            align-content: center;
            height: auto;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%); /* Center the container both horizontally and vertically */
            z-index: 1000;
            box-sizing: border-box; /* Ensure padding is included in the element's total width and height */
        }
        
          
          /* For small devices (phones, less than 600px) */
          @media only screen and (max-width: 600px) {
            .calendar-container {
              width: 90%;
              top: 20%;
              left: 50%;
              transform: translate(-50%, 0);
            }
          }
          
          /* For medium devices (tablets, 600px to 768px) */
          @media only screen and (min-width: 600px) and (max-width: 768px) {
            .calendar-container {
              width: 80%;
              top: 20%;
              left: 50%;
              transform: translate(-50%, 0);
            }
          }
          
          .calendar-nav,
          .calendar-header,
          .calendar,
          .legend {
            user-select: none;
          }
          
          .calendar-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            background: #23252D; /* Aquatic theme header */
            color: white; /* Office theme text color */
            border-top-left-radius: 8px; /* Ensure corners are rounded */
            border-top-right-radius: 8px;
          }
          
          .calendar-nav button {
            background: none;
            border: none;
            color: white; /* Office theme button color */
            font-size: 18px;
            cursor: pointer;
            padding: 5px 10px;
            transition: background-color 0.3s;
          }
          
          .calendar-nav button:hover {
            background-color: rgba(0, 0, 0, 0.1);
            border-radius: 4px;
          }
          
          .calendar-nav span {
            font-size: 18px;
            font-weight: bold;
          }
          
          .calendar-header {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: #23252D; /* Aquatic theme header */
            color: white; /* Office theme text color */
            text-align: center;
            padding: 10px 0;
            font-weight: bold;
          }
          
          .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: #e0f7fa; /* Aquatic theme body */
          }
          
          .calendar .day {
            background: #b2dfdb; /* Aquatic theme day background */
            color: #004d40; /* Aquatic theme day text */
            padding: 10px;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.3s;
          }
          
          .calendar .day:hover {
            background-color: #80cbc4; /* Aquatic theme hover effect */
          }
          
          .calendar .day.booked {
            background-color: lightcoral; /* Booked color */
            color: white;
          }
          
          .calendar .day.pending {
            background-color: #fff176; /* Pending color */
            color: black;
          }
          
          .calendar .day.not-booked {
            background-color: #68d391; /* Not booked color */
            color: black;
          }
          
          .day {
            width: 100%;
            padding: 10px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            background-color: white; /* Office theme background */
            color: #333; /* Office theme text color */
            border-radius: 50%; /* Changed to circle */
            transition: box-shadow 0.3s, transform 0.3s;
          }
          
          .day:hover {
            background-color: #e0e0e0; /* Darker shade on hover */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transform: scale(1.05); /* Slight zoom effect */
          }
          
          .day.hidden {
            visibility: hidden;
          }
          
          .event-info {
            font-size: 12px;
            margin-top: 4px;
            text-align: center;
          }
          
          @media (max-width: 640px) {
            .calendar-header div,
            .calendar .day {
              font-size: 12px;
            }
          }
          
          @media (max-width: 480px) {
            .calendar-header div,
            .calendar .day {
              font-size: 10px;
            }
          }
          
          .legend {
            display: flex;
            justify-content: space-around;
            padding: 10px;
            margin-top: 20px;
            background-color: #23252D;
            border-radius: 8px;
            width: 100%;
            color: white;
          }
          
          .legend-item {
            display: flex;
            align-items: center;
          }
          
          .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            margin-right: 8px;
          }
          
          .full-booked-legend {
            background-color: lightcoral;
          }
          
          .not-booked-legend {
            background-color: #68d391;
          }
          
          .pending-legend {
            background-color: rgb(236, 236, 151);
          }
          
          /* Close calendar button */
          .calendarclose-button {
            padding: 2px 4px;
            background-color: #c53030; /* Red background color */
            color: lightcoral; /* Gray text color */
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s ease, color 0.3s ease; /* Smooth transition */
          }
          
          .calendarclose-button:hover {
            background-color: #a12828; /* Darker red on hover */
            color: lightcoral; /* White text color on hover */
          }
          
          .calendarclose-button .icon {
            width: 12px;
            height: 12px;
          }
          
          .calendarclose-button .label {
            display: none;
          }
          
          .ml-auto {
            margin-left: auto;
          }
          
          /* Optional: Add fade-in and fade-out animations */
          @keyframes fadeIn {
            from {
              opacity: 0;
            }
            to {
              opacity: 1;
            }
          }
          
          @keyframes fadeOut {
            from {
              opacity: 1;
            }
            to {
              opacity: 0;
            }
          }
          
          .fade-in {
            animation: fadeIn 0.3s ease-in-out;
          }
          
          .fade-out {
            animation: fadeOut 0.3s ease-in-out;
          }
          /* Container */
/* Container */
.responsive-container {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin: 0 auto;
    width: 100%;
    padding: 0 1rem;
    box-sizing: border-box;
}

/* Select and Input */
/* Container */
.responsive-container {
    display: flex;
    flex-wrap: nowrap;
    gap: 0.5rem; /* Space between elements */
    margin: 0 auto;
    width: 100%;
    max-width: 100%;
    box-sizing: border-box;
    padding: 0 1rem; /* Padding for responsiveness */
}

/* Select and Input */
.responsive-select {
    flex: 1;
    min-width: 100px;
    padding: 0.5rem;
    background-color: #374151; /* bg-gray-700 */
    color: #9CA3AF; /* text-gray-400 */
    border-radius: 0.375rem; /* rounded */
    border: none; /* Remove default border */
    box-sizing: border-box;
}

/* Media Queries for Responsive Design */
@media (min-width: 768px) {
    .responsive-select {
        flex: 1 1 30%; /* Adjust size for medium screens */
    }
}

@media (min-width: 1024px) {
    .responsive-container {
        max-width: 75%; /* Max width for larger screens */
    }

    .responsive-select {
        flex: 1 1 32%; /* Adjust size for larger screens */
    }
}



    




            
            /*slots*/
            .time-slot-popup {
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background-color: #04172b; /* Dark blue background */
                border: 1px solid #ccc;
                padding: 20px;
                border-radius: 10px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
                z-index: 1000;
                color: white; 
                max-width: 90%; 
                max-height: 90%; 
              
            }
            
            
            
            
            .time-slot-content {
                margin-top: 10px;
            }
            
            .time-slot-chart {
                display: flex;
                align-items: center;
                justify-content: space-between; /* Adjust  */
                gap: 10px; /* Or use margin: 10px;*/
                overflow-x: auto; /* Enable horizontal scrolling */
                overflow-y: hidden; /* Disable vertical scrolling */
            }
            
            .time-slot-time,
            .time-slot-status {
                padding: 10px;
                border: 2px solid #ccc;
                text-align: center;
                flex: 1; /* Take up remaining space */
                transition: transform 0.3s ease-out; /* Smooth transition for size change */
            }
            
           
            .time-slot-status:hover {
                transform: scale(1.1); /* Increase size on hover */
            }
             
    
            
            .status-data {
                position: absolute;
                top: -100%; /* Start from above the box */
                left: 0;
                width: auto;
                height: auto;
                background-color: transparent; /* Transparent initially */
                animation: slideInDown 0.5s forwards; /* Animation for sliding in */
                text-align: center;
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                transition: transform 0.3s ease-out; /* Smooth transition for size change */
            }
            
            .status-data:hover {
                transform: scale(1.2); /* Increase size on hover */
            }
            
            @keyframes slideInDown {
                from {
                    top: -100%; /* Start from above the box */
                }
                to {
                    top: 0; /* Slide in downwards */
                }
            }
            
            
            
            .booked {
                background-color: lightcoral; /* Light red background for booked slots */
            }
            
            .pending {
                background-color: rgb(236, 236, 151); /* Light yellow background for pending slots */
                color: black;
            }
            
            .free {
                background-color: lightgreen; /* Green background for free slots */
            }
            
            .close-button {
                display: block;
                margin: 10px auto;
                padding: 5px 10px;
                background-color: #f44336; /* Red close button */
                color: white;
                border: none;
                border-radius: 5px;
                cursor: pointer;
            }
            
            .close-button:hover {
                background-color: #d32f2f; /* Darker red hover color */
            }
            
            .time-slot-popup.disappear {
                opacity: 0;
            }
            
          
            .nav-buttons {
                display: flex;
                justify-content: space-between;
                margin-top: 40px;
            }
            
            .nav-buttons button {
                background-color: transparent;
                border: none;
                cursor: pointer;
                transition: all 0.3s ease;
                font-weight: bold;
                color: white; /* Adjust text color as needed */
                font-size: 1.2em; /* Adjust font size as needed */
                padding: 5px 10px; /* Adjust padding as needed */
            }
            
            .nav-buttons button:hover {
                transform: scale(1.1);
                color: #555; /* Adjust hover text color */
            }
            
            .nav-buttons button:focus {
                outline: none;
            }
            
            .nav-buttons button:active {
                transform: scale(0.9);
            }
            
            /* for submit button */
            
            
.free:hover {
    background-color: #555;
  }
  
  .selected {
    background-color: #0a74da;
    color: #fff;
    transition: background-color 0.3s;
  }
  
  .select-animation {
    animation: selectFade 0.3s;
  }
  
  .unselect-animation {
    animation: unselectFade 0.3s;
  }
  
  .submit-container {
    margin-top: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .submit-button {
    background-color: #0a74da;
    color: #fff;
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s;
  }
  
  .submit-button:hover {
    background-color: #005bb5;
  }
  
  .selected-count {
    font-size: 16px;
  }
  
  .nav-buttons {
    display: flex;
    justify-content: space-between;
    margin-top: 20px;
  }
  
  .nav-button {
    background: none;
    border: none;
    color: #fff;
    font-size: 20px;
    cursor: pointer;
  }
  
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
  
  @keyframes selectFade {
    from { background-color: #555; }
    to { background-color: #0a74da; }
  }
  
  @keyframes unselectFade {
    from { background-color: #0a74da; }
    to { background-color: #555; }
  }
  
  
  .hidden {
    display: none;
  }
  
  /*for calendar icon  in form */
  .relative {
    display: flex;
    justify-content: center;
    align-items: center;
    
  }
        </style>
</head>
<body>


    <header>
   

    <header>
        <div class="navbar">
            <div class="logo-container">
                <div class="logo">
                    <img src="{{ url_for('static',filename='L1.png') }}" alt="Logo">
                </div>
                <div class="name">
                    <img src="{{ url_for('static',filename='L2.png')}}" alt="Name Logo">
                </div>
            </div>
            <div class="menu">
                <a href="{{url_for('admin')}}" class="menu-item">
                    <i class="fas fa-home"></i> Home
                </a>
                <a href="{{url_for('adminnoti')}}"  class="menu-item">
                    <i class="fas fa-bell"></i> Updates
                </a>
                <a href="{{url_for('adminbooking')}}" class="menu-item">All Booking</a>
                <a href="{{url_for('home')}}" class="menu-item"> <i class="fas fa-power-off"></i> Logout</a>
            </div>
        </div>
    </header>






    <div class="calendar-container">
        <div class="calendar-nav">
            <button id="prevMonth">&lt;</button>
            <span id="monthYear"></span>
            <button id="nextMonth">&gt;</button>
        </div>
        <div class="responsive-container">
          <select id="hallDropdown" name="hallDropdown" class="responsive-select">
              <option value="Auditorium">Auditorium</option>
              <option value="SeminarHall">Seminar Hall</option>
              <option value="Room105">Room 105</option>
              <option value="CRCConferenceRoom">CRC Conference Room</option>
              <option value="AIITConferenceRoom">AIB Conference Room</option>
              <option value="RICSConferenceRoom">RICS Conference Room</option>
              <option value="Atrium">Atrium</option>
          </select>
          <select id="monthSelect" class="responsive-select readonly">
              <!-- Options will be populated by JavaScript -->
          </select>
          <input type="date" id="dateSearch" class="responsive-input">
      </div>
        <div class="calendar-header">
            <div>Sun</div>
            <div>Mon</div>
            <div>Tue</div>
            <div>Wed</div>
            <div>Thu</div>
            <div>Fri</div>
            <div>Sat</div>
        </div>
        <div id="calendar" class="calendar"></div>
        <div id="calendar" class="calendar"></div>
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color full-booked-legend"></div>
                <span>Booked Slots</span>
            </div>
            <div class="legend-item">
                <div class="legend-color not-booked-legend"></div>
                <span>Not Booked Slots</span>
            </div>
            <div class="legend-item">
                <div class="legend-color .pending-legend"></div>
                <span>Pending Slots</span>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const calendar = document.getElementById('calendar');
            const monthYearDisplay = document.getElementById('monthYear');
            const prevMonthButton = document.getElementById('prevMonth');
            const nextMonthButton = document.getElementById('nextMonth');
            const monthSelect = document.getElementById('monthSelect');
            const yearSelect = document.getElementById('yearSelect');
            const dateSearch = document.getElementById('dateSearch');
            const hallDropdown = document.getElementById('hallDropdown');
        
            let currentDate = new Date();
            let currentHall = 'Auditorium';
            let selectedDate = '';
        
            const hallData = {
                Auditorium: {
    //                 '2024-07-01': [
    //   { starttime: '9 am', endtime: '11 am', status: 'booked', school: 'Amity shool of enginering and science', event: 'Event A',eventcordinator: 'Eventtttttttttttttttttt' },
    //   { starttime: '12 pm', endtime: '1 pm', status: 'booked', school: 'School A', event: 'Event A',eventcordinator: 'Eventtttttttttttttttttttt' },
    //   { starttime: '2 pm', endtime: '4 pm', status: 'pending', school: 'School A', event: 'Event A',eventcordinator: 'Event ttttttttttttttttt' },
                 // Add more data here
    // ],           
                    {%for i in output[0]%}
                  '{{i[0]}}' : [{ starttime: '{{(i[4])}}', endtime: '{{(i[1])}}', status: '{{(i[7])}}', school: '{{i[2]}}', event: '{{i[6]}}' , eventcordinator: '{{i[5]}}'}],
                    {%endfor%}
                    // '2024-07-03': [{ starttime: '9', endtime: '12', status: 'booked', school: 'School C', event: 'Event C' , eventcordinator: 'Event C'}],
                    // '2024-07-04': [{ starttime: '9', endtime: '12', status: 'booked', school: 'School D', event: 'Event D' ,eventcordinator: 'Event C'}],
                    // '2024-07-07': [{ starttime: '9', endtime: '10', status: 'pending', school: 'School J', event: 'Event J' ,eventcordinator: 'Event C'}],
                },

                SeminarHall: {
                    {%for i in output[1]%}
                    '{{i[0]}}' : [{ starttime: '{{(i[4])}}', endtime: '{{(i[1])}}', status: '{{(i[7])}}', school: '{{i[2]}}', event: '{{i[6]}}' , eventcordinator: '{{i[5]}}'}],
                    {%endfor%}
                    // '2024-06-01': [{ starttime: '1 pm', endtime: '2 pm', status: 'booked', school: 'ABI', event: 'AS' , eventcordinator: 'AS'}],
                    // '2024-07-22': [{ starttime: '1 pm', endtime: '9 am', status: 'booked', school: 'hi', event: 'AS2' , eventcordinator: 'AS'}],
                    // '2024-07-26': [{ starttime: '1 pm', endtime: '9 am', status: 'booked', school: 'ABI', event: 'AS2' , eventcordinator: 'AS'}],
                    
                   
                },
                Room105: {
                    {%for i in output[2]%}
                    '{{i[0]}}' : [{ starttime: '{{(i[4])}}', endtime: '{{(i[1])}}', status: '{{(i[7])}}', school: '{{i[2]}}', event: '{{i[6]}}' , eventcordinator: '{{i[5]}}'}],
                    {%endfor%}
                    // '2024-07-06': [{ starttime: '9', endtime: '10', status: 'booked', school: 'School F', event: 'Event F',eventcordinator: 'Event C' }],
                    // '2024-07-07': [{ starttime: '9', endtime: '12', status: 'booked', school: 'School G', event: 'Event G' ,eventcordinator: 'Event C'}],
                },
                CRCConferenceRoom: {
                    {%for i in output[3]%}
                    '{{i[0]}}' : [{ starttime: '{{(i[4])}}', endtime: '{{(i[1])}}', status: '{{(i[7])}}', school: '{{i[2]}}', event: '{{i[6]}}' , eventcordinator: '{{i[5]}}'}],
                    {%endfor%}
                    // '2024-07-08': [{ starttime: '9', endtime: '10', status: 'booked', school: 'School H', event: 'Event H',eventcordinator: 'Event C' }],
                    // '2024-07-09': [{ starttime: '9', endtime: '12', status: 'booked', school: 'School I', event: 'Event I',eventcordinator: 'Event C' }],
                },
                AIITConferenceRoom: {
                    {%for i in output[4]%}
                    '{{i[0]}}' : [{ starttime: '{{(i[4])}}', endtime: '{{(i[1])}}', status: '{{(i[7])}}', school: '{{i[2]}}', event: '{{i[6]}}' , eventcordinator: '{{i[5]}}'}],
                    {%endfor%}
                    // '2024-07-08': [{ starttime: '9', endtime: '10', status: 'booked', school: 'School H', event: 'Event H',eventcordinator: 'Event C' }],
                    // '2024-07-09': [{ starttime: '9', endtime: '12', status: 'booked', school: 'School I', event: 'Event I',eventcordinator: 'Event C' }],
                },
                RICSConferenceRoom: {
                    {%for i in output[5]%}
                    '{{i[0]}}' : [{ starttime: '{{(i[4])}}', endtime: '{{(i[1])}}', status: '{{(i[7])}}', school: '{{i[2]}}', event: '{{i[6]}}' , eventcordinator: '{{i[5]}}'}],
                    {%endfor%}
                    // '2024-07-08': [{ starttime: '9', endtime: '10', status: 'booked', school: 'School H', event: 'Event H',eventcordinator: 'Event C' }],
                    // '2024-07-09': [{ starttime: '9', endtime: '12', status: 'booked', school: 'School I', event: 'Event I',eventcordinator: 'Event C' }],
                },
                Atrium: {
                    {%for i in output[6]%}
                    '{{i[0]}}' : [{ starttime: '{{(i[4])}}', endtime: '{{(i[1])}}', status: '{{(i[7])}}', school: '{{i[2]}}', event: '{{i[6]}}' , eventcordinator: '{{i[5]}}'}],
                    {%endfor%}
                    // '2024-07-08': [{ starttime: '9', endtime: '10', status: 'booked', school: 'School H', event: 'Event H',eventcordinator: 'Event C' }],
                    // '2024-07-09': [{ starttime: '9', endtime: '12', status: 'booked', school: 'School I', event: 'Event I',eventcordinator: 'Event C' }],
                }
            };
        
            const timeSlots = [
            '9 am - 10 am', '10 am - 11 am', '11 am - 12 pm', '12 pm - 1 pm',
            '1 pm - 2 pm', '2 pm - 3 pm', '3 pm - 4 pm', '4 pm - 5 pm', '5 pm - 6 pm'
        ];
        
        const convertToTimeSlots = (startTime, endTime) => {
            const convertTo24Hour = (time) => {
                const [hour, modifier] = time.split(' ');
                let hourInt = parseInt(hour);
                if (modifier === 'pm' && hourInt !== 12) {
                    hourInt += 12;
                } else if (modifier === 'am' && hourInt === 12) {
                    hourInt = 0;
                }
                return hourInt;
            };
        
            const startHour = convertTo24Hour(startTime);
            const endHour = convertTo24Hour(endTime);
        
            let slots = [];
            for (let hour = startHour; hour < endHour; hour++) {
                let startHour12 = hour % 12 === 0 ? 12 : hour % 12;
                let endHour12 = (hour + 1) % 12 === 0 ? 12 : (hour + 1) % 12;
                let startModifier = hour < 12 || hour === 24 ? 'am' : 'pm';
                let endModifier = hour + 1 < 12 || hour + 1 === 24 ? 'am' : 'pm';
                
                let slot = `${startHour12} ${startModifier} - ${endHour12} ${endModifier}`;
                slots.push(slot);
            }
        
            return slots;
        };

        
        
    
       
        const updateCalendar = (container) => {
          const calendar = container.querySelector('#calendar');
          const monthYearDisplay = container.querySelector('#monthYear');
          const hallDropdown = container.querySelector('#hallDropdown');
          const monthSelect = container.querySelector('#monthSelect');
      
          calendar.innerHTML = ''; // Clear existing calendar content
      
          const year = currentDate.getFullYear();
          const month = currentDate.getMonth();
          const firstDayOfMonth = new Date(year, month, 1).getDay();
          const daysInMonth = new Date(year, month + 1, 0).getDate();
      
          // Display month and year
          monthYearDisplay.textContent = `${currentDate.toLocaleString('default', { month: 'long' })} ${year}`;
      
          // Add empty cells for days before the 1st of the month to align with Sunday
          for (let i = 0; i < firstDayOfMonth; i++) {
              const emptyDay = document.createElement('div');
              emptyDay.classList.add('day', 'empty');
              calendar.appendChild(emptyDay);
          }
      
          // Add days of the month
          for (let day = 1; day <= daysInMonth; day++) {
              const dateKey = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
              const dayElement = document.createElement('div');
              dayElement.classList.add('day');
              dayElement.textContent = day;
      
              const bookings = hallData[currentHall]?.[dateKey];
              if (bookings) {
                  let bookedSlots = 0;
                  let remainingSlots = [...timeSlots];
      
                  bookings.forEach(booking => {
                      const slots = convertToTimeSlots(booking.starttime, booking.endtime);
                      slots.forEach(slot => {
                          bookedSlots++;
                          remainingSlots = remainingSlots.filter(s => s !== slot);
                      });
                  });
      
                  // Use a gradient to indicate booked slots
                  dayElement.style.backgroundImage = `linear-gradient(to top, lightcoral ${bookedSlots * 10}%, transparent ${bookedSlots * 10}%)`;
      
                  // Show remaining slots on hover
                  dayElement.title = `Free slots: ${remainingSlots.join(', ')}`;
              } else {
                  dayElement.classList.add('not-booked');
              }
      
              // Add event listener to show time slot popup
              dayElement.addEventListener('click', () => showTimeSlotPopup(dateKey));
              calendar.appendChild(dayElement);
          }
      
          // Ensure the calendar has rows for all days of the week 
          const totalCells = calendar.children.length;
          const rows = Math.ceil(totalCells / 7);
          const totalCellsNeeded = rows * 7;
      
          for (let i = totalCells; i < totalCellsNeeded; i++) {
              const emptyDay = document.createElement('div');
              emptyDay.classList.add('day', 'empty');
              calendar.appendChild(emptyDay);
          }
      };
      
      const populateMonthSelect = (container) => {
          const monthSelect = container.querySelector('#monthSelect');
          const months = [
              'January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'
          ];
          months.forEach((month, index) => {
              const option = document.createElement('option');
              option.value = index;
              option.textContent = month;
              monthSelect.appendChild(option);
          });
          monthSelect.value = currentDate.getMonth();
      };
      
      // Event listeners for multiple calendar containers
      document.querySelectorAll('.calendar-container').forEach(container => {
          const monthSelect = container.querySelector('#monthSelect');
          const hallDropdown = container.querySelector('#hallDropdown');
          const dateSearch = container.querySelector('#dateSearch');
          const prevMonthButton = container.querySelector('#prevMonth');
          const nextMonthButton = container.querySelector('#nextMonth');
      
          monthSelect.addEventListener('change', () => {
              currentDate.setMonth(monthSelect.value);
              updateCalendar(container);
          });
      
          hallDropdown.addEventListener('change', () => {
              currentHall = hallDropdown.value;
              updateCalendar(container);
          });
      
          dateSearch.addEventListener('change', () => {
              selectedDate = new Date(dateSearch.value);
              if (!isNaN(selectedDate)) {
                  currentDate = selectedDate;
                  monthSelect.value = currentDate.getMonth();
                  updateCalendar(container);
              }    
          });
      
          prevMonthButton.addEventListener('click', () => {
              currentDate.setMonth(currentDate.getMonth() - 1);
              monthSelect.value = currentDate.getMonth();
              updateCalendar(container);
          });
      
          nextMonthButton.addEventListener('click', () => {
              currentDate.setMonth(currentDate.getMonth() + 1);
              monthSelect.value = currentDate.getMonth();
              updateCalendar(container);
          });
      
          populateMonthSelect(container);
          updateCalendar(container);
      });
      





      let selectedSlots = [];

      const showTimeSlotPopup = (dateKey) => {
          // Remove existing popup if any
          closePopup();
      
          const popup = document.createElement('div');
          popup.classList.add('time-slot-popup');
          popup.style.zIndex = '9999'; // Adjust z-index as needed to ensure it appears above other elements
      
          const title = document.createElement('h3');
          title.textContent = `Booking Status for ${dateKey}`;
          popup.appendChild(title);
      
          const closeButton = document.createElement('button');
          closeButton.classList.add('close-button');
          closeButton.innerHTML = '<i class="fas fa-times"></i>';
          closeButton.addEventListener('click', () => {
              closePopup();
          });
          popup.appendChild(closeButton);
      
          const timeSlotContent = document.createElement('div');
          timeSlotContent.classList.add('time-slot-content');
          popup.appendChild(timeSlotContent);
      
          const chart = document.createElement('div');
          chart.classList.add('time-slot-chart');
          timeSlotContent.appendChild(chart);
      
          timeSlots.forEach((timeSlot) => {
              const slotElement = createTimeSlotElement(timeSlot, dateKey);
              chart.appendChild(slotElement);
          });
      
          const navButtons = document.createElement('div');
          navButtons.classList.add('nav-buttons');
      
          const prevButton = document.createElement('button');
          prevButton.classList.add('nav-button', 'prev-button'); // Added 'nav-button' class for styling
          prevButton.innerHTML = '<i class="fas fa-chevron-left"></i>';
          prevButton.addEventListener('click', () => {
              const prevDateKey = getPreviousDateKey(dateKey);
              showTimeSlotPopup(prevDateKey);
          });
          navButtons.appendChild(prevButton);
      
          const nextButton = document.createElement('button');
          nextButton.classList.add('nav-button', 'next-button'); // Added 'nav-button' class for styling
          nextButton.innerHTML = '<i class="fas fa-chevron-right"></i>';
          nextButton.addEventListener('click', () => {
              const nextDateKey = getNextDateKey(dateKey);
              showTimeSlotPopup(nextDateKey);
          });
          navButtons.appendChild(nextButton);
      
          popup.appendChild(navButtons);
      
          document.body.appendChild(popup);
      
          popup.addEventListener('click', (event) => {
              if (event.target === popup) {
                  closePopup();
              }
          });
      };



        const closePopup = () => {
              const existingPopups = document.querySelectorAll('.time-slot-popup');
              existingPopups.forEach(popup => {
                  popup.classList.add('disappear');
                  setTimeout(() => popup.remove(), 300); // Delay for animation to complete
              });
              selectedSlots = []; // Reset selected slots when popup is closed
          };
          
          const getPreviousDateKey = (currentDateKey) => {
              const currentDate = new Date(currentDateKey);
              currentDate.setDate(currentDate.getDate() - 1);
              return currentDate.toISOString().split('T')[0];
          };
          
          const getNextDateKey = (currentDateKey) => {
              const currentDate = new Date(currentDateKey);
              currentDate.setDate(currentDate.getDate() + 1);
              return currentDate.toISOString().split('T')[0];
          };
          
          const createTimeSlotElement = (timeSlot, dateKey) => {
              const slotElement = document.createElement('div');
              slotElement.classList.add('time-slot-row');
          
              const timeElement = document.createElement('div');
              timeElement.classList.add('time-slot-time');
              timeElement.textContent = timeSlot;
              slotElement.appendChild(timeElement);
          
              const statusElement = document.createElement('div');
              statusElement.classList.add('time-slot-status');
          
              const bookings = hallData[currentHall][dateKey];
              let isBooked = false;
              let bookingData = [];
          
              if (bookings) {
                  bookings.forEach((booking) => {
                      const slots = convertToTimeSlots(booking.starttime, booking.endtime);
                      if (slots.includes(timeSlot)) {
                          isBooked = true;
                          const currentBookingData = `SCHOOL - ${booking.school}\nEVENT - ${booking.event}\nCOORDINATOR - ${booking.eventcordinator}`;
          
                          if (!bookingData.includes(currentBookingData)) {
                              bookingData.push(currentBookingData);
                          }
                      }
                  });
              }
          
              if (isBooked) {
                  if (bookingData.length === 1) {
                      statusElement.textContent = bookingData[0];
                      if (bookings[0].status === 'booked') {
                          statusElement.classList.add('booked');
                      } else if (bookings[0].status === 'pending') {
                          statusElement.classList.add('pending');
                      }
                  } else {
                      statusElement.textContent = `${bookingData.length} bookings`;
                      statusElement.classList.add('booked'); // Assume all bookings are of the same status
                  }
              } else {
                  statusElement.textContent = 'Free Slot';
                  statusElement.classList.add('free');
                  statusElement.addEventListener('click', () => {
                      toggleSlotSelection(slotElement, timeSlot, dateKey);
                  });
              }
          
              slotElement.appendChild(statusElement);
          
              return slotElement;
          };




    /*      
          
          const toggleSlotSelection = (slotElement, timeSlot, dateKey) => {
              const slotIndex = timeSlots.indexOf(timeSlot);
              const previousSlot = timeSlots[slotIndex - 1];
              const nextSlot = timeSlots[slotIndex + 1];
          
              if (selectedSlots.includes(timeSlot)) {
                  selectedSlots = selectedSlots.filter(slot => slot !== timeSlot);
                  slotElement.classList.remove('selected');
                  slotElement.classList.add('unselect-animation');
                  setTimeout(() => slotElement.classList.remove('unselect-animation'), 300);
              } else {
                  if (
                      (selectedSlots.length === 0) ||
                      (selectedSlots.includes(previousSlot) || selectedSlots.includes(nextSlot))
                  ) {
                      selectedSlots.push(timeSlot);
                      slotElement.classList.add('selected');
                      slotElement.classList.add('select-animation');
                      setTimeout(() => slotElement.classList.remove('select-animation'), 300);
                  } else {
                      alert('Please select continuous slots only.');
                  }
              }
              document.querySelector('.selected-count').textContent = `Selected Slots: ${selectedSlots.length}`;
          };
          
          */
        const toggleSlotSelection = (slotElement, timeSlot, dateKey) => {
    const slotIndex = timeSlots.indexOf(timeSlot);
    const previousSlot = timeSlots[slotIndex - 1];
    const nextSlot = timeSlots[slotIndex + 1];

    if (selectedSlots.includes(timeSlot)) {
        // Unselect all slots if a slot in the middle is unselected
        if (selectedSlots.length > 1 && (selectedSlots.includes(previousSlot) && selectedSlots.includes(nextSlot))) {
            selectedSlots.forEach(slot => {
                const slotElem = document.querySelector(`[data-time-slot="${slot}"]`);
                if (slotElem) {
                    slotElem.classList.remove('selected');
                    slotElem.classList.add('unselect-animation');
                    setTimeout(() => {
                        slotElem.classList.remove('unselect-animation');
                        slotElem.style.backgroundColor = ''; // Reset to normal color
                    }, 300);
                }
            });
            selectedSlots = [];
        } else {
            // Unselect the single slot
            selectedSlots = selectedSlots.filter(slot => slot !== timeSlot);
            slotElement.classList.remove('selected');
            slotElement.classList.add('unselect-animation');
            setTimeout(() => {
                slotElement.classList.remove('unselect-animation');
                slotElement.style.backgroundColor = ''; // Reset to normal color
            }, 300);
        }
    } else {
        if (
            (selectedSlots.length === 0) ||
            (selectedSlots.includes(previousSlot) || selectedSlots.includes(nextSlot))
        ) {
            selectedSlots.push(timeSlot);
            slotElement.classList.add('selected');
            slotElement.classList.add('select-animation');
            setTimeout(() => slotElement.classList.remove('select-animation'), 300);
        } else {
            alert('Please select continuous slots only.');
        }
    }
    document.querySelector('.selected-count').textContent = `Selected Slots: ${selectedSlots.length}`;
};
       //submiting 
          const submitSelectedSlots = (dateKey) => {
            if (selectedSlots.length === 0) {
                alert('No slots selected!');
                return;
            }
          
     
     
     
            // Function to convert time slots to a comparable format
function convertTo24Hour(time) {
  let [hour, period] = time.split(' ');
  hour = parseInt(hour);
  if (period === 'pm' && hour !== 12) {
      hour += 12;
  } else if (period === 'am' && hour === 12) {
      hour = 0;
  }
  return hour;
}

// Extract start and end times
const sortedSlots = selectedSlots.sort((a, b) => {
  const [startA, endA] = a.split('-').map(time => time.trim());
  const [startB, endB] = b.split('-').map(time => time.trim());
  const startHourA = convertTo24Hour(startA);
  const startHourB = convertTo24Hour(startB);
  return startHourA - startHourB;
});

const startTimeSlot = sortedSlots[0].split('-')[0].trim();
const endTimeSlot = sortedSlots[sortedSlots.length - 1].split('-')[1].trim();

console.log(`Start Time: ${startTimeSlot}`);
console.log(`End Time: ${endTimeSlot}`);







            // Mapping time slots to form values
            const timeMapping = {
              '9 am': '900',
              '10 am': '1000',
              '11 am': '1100',
              '12 pm': '1200',
              '1 pm': '1300',
              '2 pm': '1400',
              '3 pm': '1500',
              '4 pm': '1600',
              '5 pm': '1700',
              '6 pm': '1800'
            };
          
            const formStartTime = timeMapping[startTimeSlot];
            const formEndTime = timeMapping[endTimeSlot];
          
            // Format date and day
            const eventDate = new Date(dateKey).toISOString().split('T')[0];
            const dayOfWeek = new Date(dateKey).toLocaleString('en-US', { weekday: 'long' });
            const hallName = hallDropdown.value;
            // const hallname2 = getElementById('hallDropdown').value;
            // Debugging logs
            console.log('Start Slot:', startTimeSlot, 'End Slot:', endTimeSlot);
            console.log('Mapped Start Time:', formStartTime, 'Mapped End Time:', formEndTime);
            console.log('hallname : ',hallName);
            // console.log('hallname : ',hallname2);
            console.log('Submitting:', {
                date: dateKey,
                startTime: startTimeSlot,
                endTime: endTimeSlot,
                day: dayOfWeek
            });
          
            alert(`Submitted:\nDate: ${dateKey}\nStart Time: ${startTimeSlot}\nEnd Time: ${endTimeSlot}\nDay: ${dayOfWeek}`);
          
            closePopup(); // Close the popup after submission
            window.location.href = `{{server_link}}/calender/form/${hallName}/${dateKey}/${formStartTime}/${formEndTime}/${dayOfWeek}`;
          };
          
          
          
          







        });
  
    </script>
    </body>
    </html>
