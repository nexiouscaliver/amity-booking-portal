<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booking Calendar</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            background-color: aliceblue;
            margin: 0;
            font-family: Arial, sans-serif;
        }
        
        :root {
            --primary-color: #04172b;
            --secondary-color: #061b31;
            --white: #ffffff;
            --gray: #6c757d;
        }
        
        .navbar {
            background-color: var(--primary-color);
            display: flex;
            justify-content: space-evenly; /* maing the space evenly*/
            align-items: center;
            padding: 10px 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .navbar .logo {
            display: flex;
            align-items: center;
        }
        
        .navbar .logo img {
            width: fit-content;
            height: 40px;
            margin-right: 10px;
        }
        
        .navbar .logo a {
            color: var(--white);
            font-size: 24px;
            text-decoration: none;
            font-weight: bold;
        }
        
        .navbar .menu {
            display: flex;
            gap: 20px;
        }
        
        .navbar .menu a {
            color: var(--white);
            text-decoration: none;
            padding: 10px 15px;
            border-radius: 5px;
            transition: background-color 0.3s, box-shadow 0.3s;
            font-weight: bold;
        }
        
        .navbar .menu a:hover {
            background-color: var(--secondary-color);
            transform: scale(1.05);
            box-shadow: 0 0 0 2px aliceblue;
        }
        
        
        .calendar-container {
            background:#04172b;
            border-radius: 20px; /* Adjust the radius for a more curved appearance */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            width: 70%; /* Adjust as needed */
            margin: 0 auto; /* Center horizontally */
            padding: 20px;
            position: relative;
            
            height:auto;
            margin: 20px auto; /* Center the container horizontally with margin auto */
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .calendar-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            background-image: radial-gradient( circle farthest-corner at 10% 20%,  rgba(100,43,115,1) 0%, rgba(4,0,4,1) 90% );; /* Tailwind gray-800 */
            color:white; /* Office theme text color */
            border-top-left-radius: 20px; /* Ensure corners are rounded */
            border-top-right-radius: 20px;
        }
        
        .calendar-nav button {
            background: none;
            border: none;
            color: #333; /* Office theme button color */
            font-size: 18px;
            cursor: pointer;
            padding: 5px 10px;
            transition: background-color 0.3s;
        }
        
        .calendar-nav button:hover {
            background-color: rgba(0, 0, 0, 0.1);
            border-radius: 4px;
        }
        
        .calendar-nav span {
            font-size: 18px;
            font-weight: bold;
        }
        
        .calendar-header {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            background-image: radial-gradient( circle farthest-corner at 10% 20%,  rgba(100,43,115,1) 0%, rgba(4,0,4,1) 90% );; /* Tailwind gray-800 */
            color: white; /* Office theme text color */
            text-align: center;
            padding: 10px 0;
            font-weight: bold;
            border-bottom-left-radius: 20px; /* Ensure corners are rounded */
            border-bottom-right-radius: 20px;
            
        }
        
        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background-image: radial-gradient( circle farthest-corner at 10% 20%,  rgba(100,43,115,1) 0%, rgba(4,0,4,1) 90% );; /* Tailwind gray-800 */
            border-bottom-left-radius: 20px; /* Ensure corners are rounded */
            border-bottom-right-radius: 20px;
        }
        
        .day {
            width: 100%;
            padding: 10px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            background-color: white; /* Office theme background */
            color: #333; /* Office theme text color */
            border-radius: 50%;  /* Changed to circle */
            transition: box-shadow 0.3s, transform 0.3s;
        }
        
        .day:hover {
            background-color: #e0e0e0; /* Darker shade on hover */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transform: scale(1.05);  /* Slight zoom effect */
        }
        
        .day.hidden {
            visibility: hidden;
        }
        
        .event-info {
            font-size: 12px;
            margin-top: 4px;
            text-align: center;
        }
        
        @media (max-width: 640px) {
            .calendar-header,
            .calendar {
                grid-template-columns: repeat(3, 1fr);
            }
        
            .day {
                font-size: 14px;
                padding: 5px;
            }
        }
        
        @media (max-width: 480px) {
            .calendar-header,
            .calendar {
                grid-template-columns: repeat(2, 1fr);
            }
        
            .day {
                font-size: 12px;
                padding: 3px;
            }
        }
        



        .legend {
            display: flex;
            justify-content: space-around;
            padding: 10px;
            margin-top: 20px;
             background-image: radial-gradient( circle farthest-corner at 10% 20%,  rgba(100,43,115,1) 0%, rgba(4,0,4,1) 90% );; /* Tailwind gray-800 */
            border-radius: 8px;
            width: 100%;
            color:white;
            
        }
    
        
        .legend-item {
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            margin-right: 8px;
        }
        
        .full-booked-legend {
            background-color: #e53e3e;
        }
        
        .not-booked-legend {
            background-color: #68d391;
        }
        
        .first-half-booked-legend {
            background-color: #ed8936;
        }
        
        .second-half-booked-legend {
            background-color: #4299e1;
        }
        
        @media (max-width: 640px) {
            .calendar-header,
            .calendar {
                grid-template-columns: repeat(3, 1fr);
                
            }
        
            .day {
                font-size: 14px;
                padding: 5px;
            }
        }
        
        @media (max-width: 480px) {
            .calendar-header,
            .calendar {
                grid-template-columns: repeat(2, 1fr);
            }
        
            .day {
                font-size: 12px;
                padding: 3px;
            }
        }








        
        
        /*slots*/
        
.time-slot-popup {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: white;
    border: 1px solid #ccc;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    z-index: 1000;
    width: 80%;
    max-width: 600px;
}

.time-slot-content {
    margin-top: 10px;
}

.time-slot-chart {
    display: grid;
    grid-template-columns: 1fr 3fr;
    gap: 5px;
}

.time-slot-row {
    display: contents; /* Let the parent grid handle layout */
}

.time-slot-time {
    padding: 10px;
    border: 1px solid #ccc;
    text-align: center;
}

.time-slot-status {
    padding: 10px;
    border: 1px solid #ccc;
    text-align: center;
    background-color: lightgreen; /* Default background for free slots */
    color: white;
}

.booked {
    background-color: lightcoral; /* Light red background for booked slots */
}

.pending {
    background-color: lightyellow; /* Light yellow background for pending slots */
    color: black;
}

.free {
    background-color: lightgreen; /* Green background for free slots */
}

.disappear {
    opacity: 0;
    transition: opacity 0.3s ease-in-out;
}

.close-button {
    display: block;
    margin: 10px auto;
    padding: 5px 10px;
    background-color: #f44336;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

.close-button:hover {
    background-color: #d32f2f;
}
keyframes popIn {
    from {
      opacity: 0;
      transform: scale(0.9);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }
  


        
        
        /*slots*/
        
.time-slot-popup {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: white;
    border: 1px solid #ccc;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    z-index: 1000;
    width: 80%;
    max-width: 600px;
}

.time-slot-content {
    margin-top: 10px;
}

.time-slot-chart {
    display: grid;
    grid-template-columns: 1fr 3fr;
    gap: 5px;
}

.time-slot-row {
    display: contents; /* Let the parent grid handle layout */
}

.time-slot-time {
    padding: 10px;
    border: 1px solid #ccc;
    text-align: center;
}

.time-slot-status {
    padding: 10px;
    border: 1px solid #ccc;
    text-align: center;
    background-color: lightgreen; /* Default background for free slots */
    color: white;
}

.booked {
    background-color: lightcoral; /* Light red background for booked slots */
}

.pending {
    background-color: lightyellow; /* Light yellow background for pending slots */
    color: black;
}

.free {
    background-color: lightgreen; /* Green background for free slots */
}

.disappear {
    opacity: 0;
    transition: opacity 0.3s ease-in-out;
}

.close-button {
    display: block;
    margin: 10px auto;
    padding: 5px 10px;
    background-color: #f44336;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

.close-button:hover {
    background-color: #d32f2f;
}
keyframes popIn {
    from {
      opacity: 0;
      transform: scale(0.9);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }
  



    </style>
</head>
<body>
    <header>
        <div class="navbar">
            <div class="logo">
                <img src="{{url_for('static',filename='Amity-logo.png')}}" alt="Logo">
                <img src="{{url_for('static',filename='name.2.png')}}" alt="Logo">
            </div>
            <div class="menu">
                <a href="{{url_for('admin')}}">Home</a>
                <a href="{{url_for('home')}}">Logout</a>
            </div>
        </div>
    </header>

    <div class="calendar-container">
        <div class="calendar-nav">
            <button id="prevMonth">&lt;</button>
            <span id="monthYear"></span>
            <button id="nextMonth">&gt;</button>
        </div>
        <div class="flex justify-center mb-4">
            <select id="hallDropdown" class="mx-2 p-2 bg-gray-700 text-gray-400 rounded">
                <option value="Auditorium">Auditorium</option>
                <option value="SeminarHall">Seminar Hall</option>
                <option value="Room105">Room 105</option>
                <option value="AIITConferenceRoom">AIIT Conference Room</option>
                <option value="RICSConferenceRoom">RICS  Conference Room</option>
                <option value="Atrium">Atrium</option>
            </select>
            <select id="monthSelect" class="mx-2 p-2 bg-gray-700 text-gray-400 rounded readonly ">
                <!-- Options will be populated by JavaScript -->
            </select>
            <input type="date" id="dateSearch" class="p-2 bg-gray-700 text-gray-400 rounded">
        </div>
        <div class="calendar-header">
            <div>Sun</div>
            <div>Mon</div>
            <div>Tue</div>
            <div>Wed</div>
            <div>Thu</div>
            <div>Fri</div>
            <div>Sat</div>
        </div>
        <div id="calendar" class="calendar"></div>
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color full-booked-legend"></div>
                <span>Fully Booked</span>
            </div>
            <div class="legend-item">
                <div class="legend-color not-booked-legend"></div>
                <span>Not Booked</span>
            </div>
            <div class="legend-item">
                <div class="legend-color first-half-booked-legend"></div>
                <span>First Half Booked</span>
            </div>
            <div class="legend-item">
                <div class="legend-color second-half-booked-legend"></div>
                <span>Second Half Booked</span>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const calendar = document.getElementById('calendar');
            const monthYearDisplay = document.getElementById('monthYear');
            const prevMonthButton = document.getElementById('prevMonth');
            const nextMonthButton = document.getElementById('nextMonth');
            const monthSelect = document.getElementById('monthSelect');
            const yearSelect = document.getElementById('yearSelect');
            const dateSearch = document.getElementById('dateSearch');
            const hallDropdown = document.getElementById('hallDropdown');
        
            let currentDate = new Date();
            let currentHall = 'Auditorium';
            let selectedDate = '';
        
            const hallData = {
                Auditorium: {
                    '2024-07-01': [
      { starttime: '9 am', endtime: '11 am', status: 'booked', school: 'School A', event: 'Event A',eventcordinator: 'Event C' },
      { starttime: '12 pm', endtime: '3 pm', status: 'booked', school: 'School A', event: 'Event A',eventcordinator: 'Event C' },
      { starttime: '4 pm', endtime: '5 pm', status: 'pending', school: 'School A', event: 'Event A',eventcordinator: 'Event C' },
      // Add more data here
    ],
                    '2024-07-03': [{ starttime: '9', endtime: '12', status: 'booked', school: 'School C', event: 'Event C' , eventcordinator: 'Event C'}],
                    '2024-07-04': [{ starttime: '9', endtime: '12', status: 'booked', school: 'School D', event: 'Event D' ,eventcordinator: 'Event C'}],
                    '2024-07-07': [{ starttime: '9', endtime: '10', status: 'pending', school: 'School J', event: 'Event J' ,eventcordinator: 'Event C'}],
                },

                SeminarHall: {
                    '2024-07-04': [{ starttime: '9', endtime: '10', status: 'booked', school: 'School B', event: 'Event B',eventcordinator: 'Event C' }],
                    '2024-07-04': [{ starttime: '12', endtime: '1', status: 'booked', school: 'School B', event: 'Event B',eventcordinator: 'Event C' }],
                    '2024-07-05': [{ starttime: '10', endtime: '12', status: 'booked', school: 'School E', event: 'Event E' ,eventcordinator: 'Event C'}],
                    '2024-07-08': [{ starttime: '11', endtime: '12', status: 'booked', school: 'School K', event: 'Event K',eventcordinator: 'Event C' }],
                },
                Room105: {
                    '2024-07-06': [{ starttime: '9', endtime: '10', status: 'booked', school: 'School F', event: 'Event F',eventcordinator: 'Event C' }],
                    '2024-07-07': [{ starttime: '9', endtime: '12', status: 'booked', school: 'School G', event: 'Event G' ,eventcordinator: 'Event C'}],
                },
                CRCConferenceRoom: {
                    '2024-07-08': [{ starttime: '9', endtime: '10', status: 'booked', school: 'School H', event: 'Event H',eventcordinator: 'Event C' }],
                    '2024-07-09': [{ starttime: '9', endtime: '12', status: 'booked', school: 'School I', event: 'Event I',eventcordinator: 'Event C' }],
                },
                AIITConferenceRoom: {
                    '2024-07-08': [{ starttime: '9', endtime: '10', status: 'booked', school: 'School H', event: 'Event H',eventcordinator: 'Event C' }],
                    '2024-07-09': [{ starttime: '9', endtime: '12', status: 'booked', school: 'School I', event: 'Event I',eventcordinator: 'Event C' }],
                },
                RICSConferenceRoom: {
                    '2024-07-08': [{ starttime: '9', endtime: '10', status: 'booked', school: 'School H', event: 'Event H',eventcordinator: 'Event C' }],
                    '2024-07-09': [{ starttime: '9', endtime: '12', status: 'booked', school: 'School I', event: 'Event I',eventcordinator: 'Event C' }],
                },
                Atrium: {
                    '2024-07-08': [{ starttime: '9', endtime: '10', status: 'booked', school: 'School H', event: 'Event H',eventcordinator: 'Event C' }],
                    '2024-07-09': [{ starttime: '9', endtime: '12', status: 'booked', school: 'School I', event: 'Event I',eventcordinator: 'Event C' }],
                }
            };
        
            const timeSlots = [
            '9 am - 10 am', '10 am - 11 am', '11 am - 12 pm', '12 pm - 1 pm',
            '1 pm - 2 pm', '2 pm - 3 pm', '3 pm - 4 pm', '4 pm - 5 pm', '5 pm - 6 pm'
        ];
        
        const convertToTimeSlots = (startTime, endTime) => {
            const convertTo24Hour = (time) => {
                const [hour, modifier] = time.split(' ');
                let hourInt = parseInt(hour);
                if (modifier === 'pm' && hourInt !== 12) {
                    hourInt += 12;
                } else if (modifier === 'am' && hourInt === 12) {
                    hourInt = 0;
                }
                return hourInt;
            };
        
            const startHour = convertTo24Hour(startTime);
            const endHour = convertTo24Hour(endTime);
        
            let slots = [];
            for (let hour = startHour; hour < endHour; hour++) {
                let startHour12 = hour % 12 === 0 ? 12 : hour % 12;
                let endHour12 = (hour + 1) % 12 === 0 ? 12 : (hour + 1) % 12;
                let startModifier = hour < 12 || hour === 24 ? 'am' : 'pm';
                let endModifier = hour + 1 < 12 || hour + 1 === 24 ? 'am' : 'pm';
                
                let slot = `${startHour12} ${startModifier} - ${endHour12} ${endModifier}`;
                slots.push(slot);
            }
        
            return slots;
        };
        
      
      


            // Inside the updateCalendar() function

const updateCalendar = () => {
    calendar.innerHTML = '';
    const year = currentDate.getFullYear();
    const month = currentDate.getMonth();
    const firstDay = new Date(year, month, 1).getDay();
    const daysInMonth = new Date(year, month + 1, 0).getDate();

    monthYearDisplay.textContent = `${currentDate.toLocaleString('default', { month: 'long' })} ${year}`;

    // Fill initial empty slots
    for (let i = 0; i < firstDay; i++) {
        const emptyDay = document.createElement('div');
        emptyDay.classList.add('day', 'hidden');
        calendar.appendChild(emptyDay);
    }

    // Fill days of the month
    for (let day = 1; day <= daysInMonth; day++) {
        const dateKey = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        const dayElement = document.createElement('div');
        dayElement.classList.add('day');
        dayElement.textContent = day;

        const bookings = hallData[currentHall][dateKey];
        if (bookings) {
            let bookedSlots = 0;
            let remainingSlots = [...timeSlots];

            bookings.forEach(booking => {
                const slots = convertToTimeSlots(booking.starttime, booking.endtime);
                slots.forEach(slot => {
                    bookedSlots++;
                    remainingSlots = remainingSlots.filter(s => s !== slot);
                });
            });

            dayElement.style.backgroundImage = `linear-gradient(to top, red ${bookedSlots * 10}%, transparent ${bookedSlots * 10}%)`;


            // Show remaining slots on hover
            dayElement.title = `Free slots: ${remainingSlots.join(', ')}`;
        } else {
            dayElement.classList.add('not-booked');
        }

        dayElement.addEventListener('click', () => showTimeSlotPopup(dateKey));
        calendar.appendChild(dayElement);
    }
};











const showTimeSlotPopup = (dateKey) => {
    // Remove existing popup if any
    const existingPopup = document.querySelector('.time-slot-popup');
    if (existingPopup) {
        existingPopup.classList.add('disappear');
        setTimeout(() => existingPopup.remove(), 300); // Delay for animation to complete
    }

    const popup = document.createElement('div');
    popup.classList.add('time-slot-popup');

    const title = document.createElement('h3');
    title.textContent = `Booking Status for ${dateKey}`;
    popup.appendChild(title);

    const closeButton = document.createElement('button');
    closeButton.textContent = 'Close';
    closeButton.classList.add('close-button');
    closeButton.addEventListener('click', () => {
        popup.classList.add('disappear');
        setTimeout(() => popup.remove(), 300); // Delay for animation to complete
    });
    popup.appendChild(closeButton);

    const timeSlotContent = document.createElement('div');
    timeSlotContent.classList.add('time-slot-content');
    popup.appendChild(timeSlotContent);

    const chart = document.createElement('div');
    chart.classList.add('time-slot-chart');
    timeSlotContent.appendChild(chart);

    timeSlots.forEach((timeSlot) => {
        const slotElement = createTimeSlotElement(timeSlot, dateKey);
        chart.appendChild(slotElement);
    });

    document.body.appendChild(popup);

    popup.addEventListener('click', (event) => {
        if (event.target === popup) {
            popup.classList.add('disappear');
            setTimeout(() => popup.remove(), 300); // Delay for animation to complete
        }
    });
};

const createTimeSlotElement = (timeSlot, dateKey) => {
    const slotElement = document.createElement('div');
    slotElement.classList.add('time-slot-row');

    const timeElement = document.createElement('div');
    timeElement.classList.add('time-slot-time');
    timeElement.textContent = timeSlot;
    slotElement.appendChild(timeElement);

    const statusElement = document.createElement('div');
    statusElement.classList.add('time-slot-status');

    const bookings = hallData[currentHall][dateKey];
    let isBooked = false;
    let bookingData = [];

    if (bookings) {
        bookings.forEach((booking) => {
            const slots = convertToTimeSlots(booking.starttime, booking.endtime);
            if (slots.includes(timeSlot)) {
                isBooked = true;
                const currentBookingData = `${booking.school} - ${booking.event} - ${booking.eventcordinator}`;
                if (!bookingData.includes(currentBookingData)) {
                    bookingData.push(currentBookingData);
                }
            }
        });
    }

    if (isBooked) {
        if (bookingData.length === 1) {
            statusElement.textContent = bookingData[0];
            if (bookings[0].status === 'booked') {
                statusElement.classList.add('booked');
            } else if (bookings[0].status === 'pending') {
                statusElement.classList.add('pending');
            }
        } else {
            statusElement.textContent = `${bookingData.length} bookings`;
            statusElement.classList.add('booked'); // Assume all bookings are of the same status
        }
    } else {
        statusElement.textContent = 'Free Slot';
        statusElement.classList.add('free');
    }

    slotElement.appendChild(statusElement);

    return slotElement;
};













            const populateMonthSelect = () => {
                const months = [
                    'January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'
                ];
                months.forEach((month, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = month;
                    monthSelect.appendChild(option);
                });
                monthSelect.value = currentDate.getMonth();
            };
        
            monthSelect.addEventListener('change', () => {
                currentDate.setMonth(monthSelect.value);
                updateCalendar();
            });
        
            const handleHallChange = () => {
                currentHall = hallDropdown.value;
                updateCalendar();
            };
        
            hallDropdown.addEventListener('change', handleHallChange);
        
            dateSearch.addEventListener('change', () => {
                selectedDate = new Date(dateSearch.value);
                if (!isNaN(selectedDate)) {
                    currentDate = selectedDate;
                    monthSelect.value = currentDate.getMonth();
                    updateCalendar();
                }
            });
        
            prevMonthButton.addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() - 1);
                monthSelect.value = currentDate.getMonth();
                updateCalendar();
            });
        
            nextMonthButton.addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() + 1);
                monthSelect.value = currentDate.getMonth();
                updateCalendar();
            });
        
            populateMonthSelect();
            updateCalendar();
        });
        
    </script>
</body>
</html>
