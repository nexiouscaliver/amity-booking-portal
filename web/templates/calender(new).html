<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booking Calendar</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            background-color: aliceblue;
            margin: 0;
            font-family: Arial, sans-serif;
        }
        
        :root {
            --primary-color: #04172b;
            --secondary-color: #061b31;
            --white: #ffffff;
            --gray: #6c757d;
        }
        
        .navbar {
            background-color: var(--primary-color);
            display: flex;
            justify-content: space-evenly; /* maing the space evenly*/
            align-items: center;
            padding: 10px 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .navbar .logo {
            display: flex;
            align-items: center;
        }
        
        .navbar .logo img {
            width: fit-content;
            height: 40px;
            margin-right: 10px;
        }
        
        .navbar .logo a {
            color: var(--white);
            font-size: 24px;
            text-decoration: none;
            font-weight: bold;
        }
        
        .navbar .menu {
            display: flex;
            gap: 20px;
        }
        
        .navbar .menu a {
            color: var(--white);
            text-decoration: none;
            padding: 10px 15px;
            border-radius: 5px;
            transition: background-color 0.3s, box-shadow 0.3s;
            font-weight: bold;
        }
        
        .navbar .menu a:hover {
            background-color: var(--secondary-color);
            transform: scale(1.05);
            box-shadow: 0 0 0 2px aliceblue;
        }
        
        .calendar-container {
            background: #42275a; /* fallback for old browsers */
          background: -webkit-linear-gradient(to right, #42275a, #734b6d); /* Chrome 10-25, Safari 5.1-6 */
          background: linear-gradient(to right, #42275a, #734b6d); /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            width: 80%; /* Adjusted to cover 60% of the screen */
            height:auto;
            margin: 20px auto; /* Center the container horizontally with margin auto */
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        
            .calendar-nav {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 10px 20px;
                background-image: radial-gradient( circle farthest-corner at 10% 20%,  rgba(100,43,115,1) 0%, rgba(4,0,4,1) 90% );
                color: white; 
            }
        
        
            .calendar-nav button {
                background: none;
                border: none;
                color: white; 
                font-size: 20px;
                cursor: pointer;
                padding: 5px 10px;
                transition: background-color 0.3s;
            }
        
            .calendar-nav button:hover {
                background-color: rgba(255, 255, 255, 0.1);
                border-radius: 4px;
            }
        
            .calendar-nav span {
                font-size: 20px;
                font-weight: bold;
            }
        
            .calendar-header {
                display: grid;
                grid-template-columns: repeat(7, 1fr);
                background-image: radial-gradient( circle farthest-corner at 10% 20%,  rgba(100,43,115,1) 0%, rgba(4,0,4,1) 90% ); 
                color: white;
                text-align: center;
                padding: 10px 0;
                font-weight: bold;
            }
       /* changes done here */
            .calendar {
                display: grid;
                grid-template-columns: repeat(7, 1fr);
                gap: 1px;
                background: #42275a; /* fallback for old browsers */
          background: -webkit-linear-gradient(to right, #42275a, #734b6d); /* Chrome 10-25, Safari 5.1-6 */
          background: linear-gradient(to right, #42275a, #734b6d);/* Tailwind gray-900 */
            }
        
          /*changes done here*/
          .day {
            width: 100%;
            padding: 10px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            background: #42275a; /* fallback for old browsers */
            background: -webkit-linear-gradient(to right, #42275a, #734b6d); /* Chrome 10-25, Safari 5.1-6 */
            background: linear-gradient(to right, #42275a, #734b6d);/* Tailwind gray-900 *//* changes done in acc */
            color: #1a202c;
            border-radius: 100px;
            transition: box-shadow 0.3s;
        }
        .day:hover {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .full-booked {
            background-color: #e53e3e;
        }
        
        .not-booked {
            background-color: #68d391;
        }
        
        .first-half-booked {
            background-color: #ed8936;
            color: #1a202c;
        }
        
        .second-half-booked {
            background-color: #4299e1;
            color: #1a202c;
        }
        
        .day.hidden {
            visibility: hidden;
        }
        
        .event-info {
            font-size: 12px;
            margin-top: 4px;
            text-align: center;
        }
        
        .legend {
            display: flex;
            justify-content: space-around;
            padding: 10px;
            margin-top: 20px;
             background-image: radial-gradient( circle farthest-corner at 10% 20%,  rgba(100,43,115,1) 0%, rgba(4,0,4,1) 90% );; /* Tailwind gray-800 */
            border-radius: 8px;
            width: 100%;
            color:white;
            
        }
    
        
        .legend-item {
            display: flex;
            align-items: center;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            margin-right: 8px;
        }
        
        .full-booked-legend {
            background-color: #e53e3e;
        }
        
        .not-booked-legend {
            background-color: #68d391;
        }
        
        .first-half-booked-legend {
            background-color: #ed8936;
        }
        
        .second-half-booked-legend {
            background-color: #4299e1;
        }
        
        @media (max-width: 640px) {
            .calendar-header,
            .calendar {
                grid-template-columns: repeat(3, 1fr);
                
            }
        
            .day {
                font-size: 14px;
                padding: 5px;
            }
        }
        
        @media (max-width: 480px) {
            .calendar-header,
            .calendar {
                grid-template-columns: repeat(2, 1fr);
            }
        
            .day {
                font-size: 12px;
                padding: 3px;
            }
        }





/*slots*/


/* Calendar Day (Date) */
.day {
    
   
    line-height: 30px;
    text-align: center;
    margin: 5px;
    cursor: pointer;
    position: relative;
   
}

/* Not Booked Days */
.day.not-booked:hover {
    background-color: lightgreen;
}

/* Booked Slots */
.time-slot.booked:hover {
    background-color: lightcoral;
}

/* Pending Slots */
.time-slot.pending:hover {
    background-color: lightyellow;
}

/* Free Slots */
.time-slot.not-booked:hover {
    background-color: lightgreen;
}

/* Time Slot Popup */
.time-slot-popup {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: white;
    border: 1px solid #ccc;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    padding: 20px;
    z-index: 1000;
}

/* Time Slot in Popup */
.time-slot {
    display: inline-block;
    width: 60px;
    height: 30px;
    line-height: 30px;
    text-align: center;
    margin: 5px;
    cursor: pointer;
    border-radius: 5px;
}

/* Close Button in Popup */
.close-button {
    position: absolute;
    top: 10px;
    right: 10px;
    background: none;
    border: none;
    cursor: pointer;
    font-size: 14px;
}

/* Hover Effect in Popup */
.time-slot:hover {
    background-color: lightblue;
}

/* Title in Time Slot */
/* Slot Container */
.time-slot {
    display: inline-block;
    width: 60px;
    height: 30px;
    line-height: 30px;
    text-align: center;
    margin: 5px;
    cursor: pointer;
    border-radius: 5px;
    background: linear-gradient(to right, #4facfe, #00f2fe);
    color: #fff;
    position: relative;
    overflow: hidden;
    border: 1px solid #ddd;
}

/* Grid Container for Slots */
.slot-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, 60px);
    gap: 10px;
    justify-content: center;
    align-items: center;
}

/* Hover Effect on Slots */
.time-slot:hover {
    background: linear-gradient(to right, #00f2fe, #4facfe);
    color: #fff;
    text-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
}

/* Not Booked Slots */
.time-slot.not-booked {
    background: linear-gradient(to right, #43e97b, #38f9d7);
}

.time-slot.not-booked:hover {
    background: linear-gradient(to right, #38f9d7, #43e97b);
}

/* Booked Slots */
.time-slot.booked {
    background: linear-gradient(to right, #ff0844, #ffb199);
}

.time-slot.booked:hover {
    background: linear-gradient(to right, #ffb199, #ff0844);
}

/* Pending Slots */
.time-slot.pending {
    background: linear-gradient(to right, #fbc2eb, #a6c1ee);
}

.time-slot.pending:hover {
    background: linear-gradient(to right, #a6c1ee, #fbc2eb);
}

/* Time Slot Popup */
.time-slot-popup {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: #fff; /* White background */
    border: none; /* Remove border for cleaner look */
    box-shadow: 0 5px 10px rgba(0, 0, 0, 0.15); /* Subtler and more modern shadow */
    padding: 25px; /* Slightly increased padding for readability */
    z-index: 1000;
    border-radius: 8px; /* Rounded corners for a contemporary feel */
    width: 350px; /* Adjusted width for better responsiveness */
    text-align: center;
    font-family: Arial, sans-serif; /* Modern, clean font choice */
    color: #333; /* Darker text for better contrast and readability (WCAG 2.1 AA) */
    outline: none; /* Remove default outline for focus */
  
    animation: popIn 0.3s ease-in-out forwards; /* Smooth pop-in animation */
  }
  
  /* Animation definition */
  @keyframes popIn {
    from {
      opacity: 0;
      transform: scale(0.9);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }
  
  /* Accessible focus style (optional) */
  .time-slot-popup:focus {
    box-shadow: 0 0 0 2px #007bff; /* Blue focus ring for keyboard users (WCAG 2.1 AA) */
  }
  

/* Close Button in Popup */
.close-button {
    position: absolute;
    top: 10px;
    right: 10px;
    background: none;
    border: none;
    cursor: pointer;
    font-size: 14px;
}

/* Title in Time Slot */
.time-slot[title]::before {
    content: attr(title);
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    padding: 4px;
    background-color: rgba(0, 0, 0, 0.8);
    color: white;
    font-size: 12px;
    border-radius: 4px;
    visibility: hidden;
    opacity: 0;
    transition: opacity 0.3s, visibility 0s linear 0.3s;
}

.time-slot[title]:hover::before {
    visibility: visible;
    opacity: 1;
    transition: opacity 0.3s;
}

/* Hover Effect on Day (Date) */
.day:hover {
    background-color: lightblue;
}

/* Title on Day (Date) */
.day[title]::before {
    content: attr(title);
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    padding: 4px;
    background-color: white;
    color: black;
    font-size: 12px;
    border-radius: 4px;
    visibility: hidden;
    opacity: 0;
    transition: opacity 0.3s, visibility 0s linear 0.3s;
}

.day[title]:hover::before {
    visibility: visible;
    opacity: 1;
    transition: opacity 0.3s;
}

/* Adding lines to resemble a graph */
.slot-grid::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: linear-gradient(to right, rgba(0, 0, 0, 0.1) 1px, transparent 1px),
                      linear-gradient(to bottom, rgba(0, 0, 0, 0.1) 1px, transparent 1px);
    background-size: 60px 30px;
    pointer-events: none;
}





    </style>
</head>
<body>
    <header>
        <div class="navbar">
            <div class="logo">
                <img src="{{url_for('static',filename='Amity-logo.png')}}" alt="Logo">
                <img src="{{url_for('static',filename='name.2.png')}}" alt="Logo">
            </div>
            <div class="menu">
                <a href="{{url_for('admin')}}">Home</a>
                <a href="{{url_for('home')}}">Logout</a>
            </div>
        </div>
    </header>

    <div class="calendar-container">
        <div class="calendar-nav">
            <button id="prevMonth">&lt;</button>
            <span id="monthYear"></span>
            <button id="nextMonth">&gt;</button>
        </div>
        <div class="flex justify-center mb-4">
            <select id="hallDropdown" class="mx-2 p-2 bg-gray-700 text-gray-400 rounded">
                <option value="Auditorium">Auditorium</option>
                <option value="SeminarHall">Seminar Hall</option>
                <option value="Room105">Room 105</option>
                <option value="AIITConferenceRoom">AIIT Conference Room</option>
                <option value="RICSConferenceRoom">RICS  Conference Room</option>
                <option value="Atrium">Atrium</option>
            </select>
            <select id="monthSelect" class="mx-2 p-2 bg-gray-700 text-gray-400 rounded readonly ">
                <!-- Options will be populated by JavaScript -->
            </select>
            <input type="date" id="dateSearch" class="p-2 bg-gray-700 text-gray-400 rounded">
        </div>
        <div class="calendar-header">
            <div>Sun</div>
            <div>Mon</div>
            <div>Tue</div>
            <div>Wed</div>
            <div>Thu</div>
            <div>Fri</div>
            <div>Sat</div>
        </div>
        <div id="calendar" class="calendar"></div>
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color full-booked-legend"></div>
                <span>Fully Booked</span>
            </div>
            <div class="legend-item">
                <div class="legend-color not-booked-legend"></div>
                <span>Not Booked</span>
            </div>
            <div class="legend-item">
                <div class="legend-color first-half-booked-legend"></div>
                <span>First Half Booked</span>
            </div>
            <div class="legend-item">
                <div class="legend-color second-half-booked-legend"></div>
                <span>Second Half Booked</span>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const calendar = document.getElementById('calendar');
            const monthYearDisplay = document.getElementById('monthYear');
            const prevMonthButton = document.getElementById('prevMonth');
            const nextMonthButton = document.getElementById('nextMonth');
            const monthSelect = document.getElementById('monthSelect');
            const yearSelect = document.getElementById('yearSelect');
            const dateSearch = document.getElementById('dateSearch');
            const hallDropdown = document.getElementById('hallDropdown');
        
            let currentDate = new Date();
            let currentHall = 'Auditorium';
            let selectedDate = '';
        
            const hallData = {
                Auditorium: {
                    '2024-07-01': [{ starttime: '9', endtime: '11', status: 'booked', school: 'School A', event: 'Event A' }],
                    '2024-07-03': [{ starttime: '9', endtime: '12', status: 'booked', school: 'School C', event: 'Event C' }],
                    '2024-07-04': [{ starttime: '9', endtime: '12', status: 'booked', school: 'School D', event: 'Event D' }],
                    '2024-07-07': [{ starttime: '9', endtime: '10', status: 'pending', school: 'School J', event: 'Event J' }],
                },
                SeminarHall: {
                    '2024-07-04': [{ starttime: '9', endtime: '10', status: 'booked', school: 'School B', event: 'Event B' }],
                    '2024-07-05': [{ starttime: '10', endtime: '12', status: 'booked', school: 'School E', event: 'Event E' }],
                    '2024-07-08': [{ starttime: '11', endtime: '12', status: 'booked', school: 'School K', event: 'Event K' }],
                },
                Room105: {
                    '2024-07-06': [{ starttime: '9', endtime: '10', status: 'booked', school: 'School F', event: 'Event F' }],
                    '2024-07-07': [{ starttime: '9', endtime: '12', status: 'booked', school: 'School G', event: 'Event G' }],
                },
                CRCConferenceRoom: {
                    '2024-07-08': [{ starttime: '9', endtime: '10', status: 'booked', school: 'School H', event: 'Event H' }],
                    '2024-07-09': [{ starttime: '9', endtime: '12', status: 'booked', school: 'School I', event: 'Event I' }],
                },
                AIITConferenceRoom: {
                    '2024-07-08': [{ starttime: '9', endtime: '10', status: 'booked', school: 'School H', event: 'Event H' }],
                    '2024-07-09': [{ starttime: '9', endtime: '12', status: 'booked', school: 'School I', event: 'Event I' }],
                },
                RICSConferenceRoom: {
                    '2024-07-08': [{ starttime: '9', endtime: '10', status: 'booked', school: 'School H', event: 'Event H' }],
                    '2024-07-09': [{ starttime: '9', endtime: '12', status: 'booked', school: 'School I', event: 'Event I' }],
                },
                Atrium: {
                    '2024-07-08': [{ starttime: '9', endtime: '10', status: 'booked', school: 'School H', event: 'Event H' }],
                    '2024-07-09': [{ starttime: '9', endtime: '12', status: 'booked', school: 'School I', event: 'Event I' }],
                }

            };
        
            const timeSlots = ['9-10', '10-11', '11-12', '12-1', '1-2', '2-3', '3-4', '4-5', '5-6'];
        
            const convertToTimeSlots = (starttime, endtime) => {
                const startHour = parseInt(starttime);
                const endHour = parseInt(endtime);
                let slots = [];
                for (let hour = startHour; hour < endHour; hour++) {
                    slots.push(`${hour}-${hour + 1}`);
                }
                return slots;
            };
        
            const updateCalendar = () => {
                calendar.innerHTML = '';
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();
                const firstDay = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();
        
                monthYearDisplay.textContent = `${currentDate.toLocaleString('default', { month: 'long' })} ${year}`;
        
                // Fill initial empty slots
                for (let i = 0; i < firstDay; i++) {
                    const emptyDay = document.createElement('div');
                    emptyDay.classList.add('day', 'hidden');
                    calendar.appendChild(emptyDay);
                }
        
                // Fill days of the month
                for (let day = 1; day <= daysInMonth; day++) {
                    const dateKey = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                    const dayElement = document.createElement('div');
                    dayElement.classList.add('day');
                    dayElement.textContent = day;
        
                    const bookings = hallData[currentHall][dateKey];
                    if (bookings) {
                        let bookedSlots = 0;
                        let remainingSlots = [...timeSlots];
        
                        bookings.forEach(booking => {
                            const slots = convertToTimeSlots(booking.starttime, booking.endtime);
                            slots.forEach(slot => {
                                bookedSlots++;
                                remainingSlots = remainingSlots.filter(s => s !== slot);
                            });
                        });
        
                        dayElement.style.backgroundImage = `linear-gradient(to top, red ${bookedSlots * 10}%, transparent ${bookedSlots * 10}%)`;
        
                        // Show remaining slots on hover
                        dayElement.title = `Free slots: ${remainingSlots.join(', ')}`;
                    } else {
                        dayElement.classList.add('not-booked');
                    }
        
                    dayElement.addEventListener('click', () => showTimeSlotPopup(dateKey));
                    calendar.appendChild(dayElement);
                }
            };
        
            const showTimeSlotPopup = (dateKey) => {
                // Remove existing popup if any
                const existingPopup = document.querySelector('.time-slot-popup');
                if (existingPopup) existingPopup.remove();
        
                const popup = document.createElement('div');
                popup.classList.add('time-slot-popup');
        
                const title = document.createElement('h3');
                title.textContent = `Booking Status for ${dateKey}`;
                popup.appendChild(title);
        
                const closeButton = document.createElement('button');
                closeButton.textContent = 'Close';
                closeButton.classList.add('close-button');
                closeButton.addEventListener('click', () => {
                    popup.remove();
                });
                popup.appendChild(closeButton);
        
                const timeSlotContainer = document.createElement('div');
                timeSlotContainer.classList.add('time-slot-container');
                popup.appendChild(timeSlotContainer);
        
                timeSlots.forEach((timeSlot) => {
                    const slotElement = createTimeSlotElement(timeSlot, dateKey);
                    timeSlotContainer.appendChild(slotElement);
                });
        
                document.body.appendChild(popup);
        
                popup.addEventListener('click', (event) => {
                    if (event.target === popup) {
                        popup.remove();
                    }
                });
            };
        
            const createTimeSlotElement = (timeSlot, dateKey) => {
                const slotElement = document.createElement('div');
                slotElement.classList.add('time-slot');
                slotElement.textContent = timeSlot;
        
                const bookings = hallData[currentHall][dateKey];
                let isBooked = false;
        
                if (bookings) {
                    bookings.forEach(booking => {
                        const slots = convertToTimeSlots(booking.starttime, booking.endtime);
                        if (slots.includes(timeSlot)) {
                            isBooked = true;
                            if (booking.status === 'booked') {
                                slotElement.classList.add('booked');
                                slotElement.style.backgroundColor = 'red';
                                slotElement.title = `${booking.school} - ${booking.event}`;
                            } else if (booking.status === 'pending') {
                                slotElement.classList.add('pending');
                                slotElement.style.backgroundColor = 'yellow';
                                slotElement.title = `${booking.school} - ${booking.event}`;
                            }
                        }
                    });
                }
        
                if (!isBooked) {
                    slotElement.classList.add('not-booked');
                    slotElement.style.backgroundColor = 'green';
                    slotElement.title = 'Free Slot';
                }
        
                return slotElement;
            };
        
            const populateMonthSelect = () => {
                const months = [
                    'January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'
                ];
                months.forEach((month, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = month;
                    monthSelect.appendChild(option);
                });
                monthSelect.value = currentDate.getMonth();
            };
        
            monthSelect.addEventListener('change', () => {
                currentDate.setMonth(monthSelect.value);
                updateCalendar();
            });
        
            const handleHallChange = () => {
                currentHall = hallDropdown.value;
                updateCalendar();
            };
        
            hallDropdown.addEventListener('change', handleHallChange);
        
            dateSearch.addEventListener('change', () => {
                selectedDate = new Date(dateSearch.value);
                if (!isNaN(selectedDate)) {
                    currentDate = selectedDate;
                    monthSelect.value = currentDate.getMonth();
                    updateCalendar();
                }
            });
        
            prevMonthButton.addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() - 1);
                monthSelect.value = currentDate.getMonth();
                updateCalendar();
            });
        
            nextMonthButton.addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() + 1);
                monthSelect.value = currentDate.getMonth();
                updateCalendar();
            });
        
            populateMonthSelect();
            updateCalendar();
        });
        
    </script>
</body>
</html>
